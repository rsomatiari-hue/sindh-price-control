<script>
    // 1. APNA NAYA VERSION 12/13 WALA URL YAHAN DALAIN
    const sheetURL = "https://script.google.com/macros/s/AKfycbyF3H19bi79J8_qv1d5ItMStO_cYI3ehsfuVU72JDRbPJewgSq0qYAmn7lZSD6rVfNhSA/exec"; 

    function handleLogin() {
        const mobile = document.getElementById('mob').value.trim();
        const pass = document.getElementById('pw').value.trim();
        const btn = document.getElementById('lBtn');

        if(!mobile || !pass) { 
            alert("Mobile aur Password lazmi likhein!"); 
            return; 
        }

        btn.innerText = "رابطہ ہو رہا ہے...";
        btn.disabled = true;

        // 2. JSONP BYPASS - System Phaar Logic
        // Humne cache-buster dala hai taake browser purani memory use na kare
        const script = document.createElement('script');
        script.src = `${sheetURL}?action=login&mobile=${mobile}&pass=${pass}&callback=loginResponse&ts=${new Date().getTime()}`;
        document.body.appendChild(script);
    }

    // 3. SERVER RESPONSE HANDLER
    window.loginResponse = function(result) {
        const btn = document.getElementById('lBtn');
        
        if (result.status === "success") {
            // Data Save karein
            localStorage.setItem("userRole", result.role);
            localStorage.setItem("userCity", result.city);
            
            // Seedha Dashboard par!
            window.location.href = "complaints-list.html";
        } else {
            alert("Ghalat Maloomat! Dobara koshish karein.");
            btn.innerText = "لاگ ان کریں";
            btn.disabled = false;
        }
    }
</script>
